# **Ajax** - day05



## 回顾

1. 模板引擎
2. jqAjax使用

   

## demo-英雄检索

![1558421784378](assets/1558421784378.png)

![1558421807927](assets/1558421807927.png)

![1558421812645](assets/1558421812645.png)



### 分析

#### 布局

 	1. 顶部
      	1. 图片
		2. 版心
      	1. 顶部是tab ul+li
      	2. table
		3. 背景
      	1. 背景图
		4. loading
      	1. 宽高100%的div
      	2. loading动画是gif

#### 需求

1. 随机背景图
2. 点击tab 高亮
3. 底部内容跟随tab切换
4. 点击头像看酷炫效果



### 随机背景图

返回随机的lol英雄皮肤

- 请求地址:https://autumnfish.cn/api/cover/random
- 请求方法：get
- 请求参数：无

```
{
    "code": 200,
    "msg": "获取成功",
    "url": "http://ossweb-img.qq.com/images/lol/web201310/skin/big90000.jpg"
}
```

步骤

1. 打开网页之后，调用随机二次元图片的接口
2. 数据获取到之后设置给body的背景图即可
3. 如果希望隔一段时间来一个新的，使用定时器即可





### 点击高亮tab

步骤

 	1. 绑定点击事件，那一排tab
		2. 为点击的添加 active  类
		3. 移除他兄弟的 active 类
		4. 默认点中第一个 调用第一个的点击事件



### 底部内容跟随tab切换

- 请求地址：<https://autumnfish.cn/api/cq/category>
- 请求方法：get
- 请求参数：type，剑士，骑士，弓手，猎人，法师，祭司 

步骤

 	1. tab的点击事件中 ajax调用接口
		2. 数据回来之后渲染到页面上









### 点击头像看酷炫效果

- 请求地址：<https://autumnfish.cn/api/cq/gif>
- 请求方法：get
- 请求参数：name

步骤

 	1. 点击英雄头像
 	2. 弹出遮罩层  有loading动画
 	3. 获取该英雄对应的gif图
 	4. 获取到之后，设置到遮罩层中的img的src上即可
 	5. 双击关闭遮罩层

重点

ajax中经常需要动态创建元素，这些元素不能直接绑定事件

可以使用事件委托把事件绑定给父元素

```js
$(父元素).on(事件名,子元素选择器,function(){})
```

### bug 第二个英雄没有loading动画

步骤

	1. 遮罩层关闭之后把gif设置回 loading动画



## demo-英雄分页

![1558428084858](assets/1558428084858.png)

###  分析

布局

1. 顶部导航
2. 分页
3. 栅格
4. 媒体对象

需求

 	1. 查询数据
 	2. 上一页
 	3. 下一页
 	4. 每次获取数据的时候 展示loading图



### 查询数据

- 请求地址：<https://autumnfish.cn/api/cq/page>
- 请求方法：get
- 请求参数：query

步骤

 	1. 点击搜索，以及文本框的 keyup 查询数据
 	2. 调用接口
      	1. query 直接从文本框获取
      	2. pageNum  为了方便修改 设置为变量
      	3. pageSize  为了方便修改 设置为变量
   	3. 数据回来之后渲染到页面上



### 上一页

步骤

1. 点击上一页

2. 页码--

3. 如果小于1 提示

4. 重新调用接口（调用抽取的方法即可）

   

### 下一页

步骤

1. 点击下一页
2. 页码++
3. 如果大于总页数 提示
4. 重新调用接口（调用抽取的方法即可）

### 上一页和下一页注意点

1. 为了方便修改页码，把页码变为变量
2. 虽然页容量没有修改依旧不建议写死在代码中
3. 这种直接写死的操作 有个名字 `magic number`,缺点如果要改动需要深入代码才可以
4. 建议 顶部把所有用到的值声明为变量



## NetWork 面板



## http协议

http协议 规范了浏览器跟服务器交互的数据格式

1. 请求报文

   1. 请求行:请求方法和请求地址
   2. 请求头:告诉服务器的一些信息
   3. 请求主体:提交到服务器的数据
   4. ajax的本质就是通过XMLHTTPRequet对象 向服务器发送请求报文

   ![1558433445114](assets/1558433445114.png)

2. 响应报文

   1. 状态行:这次请求的状态（成功与否）
   2. 响应头:服务器传递过来的额外信息，比如数据格式，语言环境，服务器信息.
   3. 响应主体:需要的数据
   4. 响应报文是服务器返回给浏览器的数据格式，是必须遵守的一个格式

   ![1558433782568](assets/1558433782568.png)

   5. jQuery自动转化JSON的本质，是根据响应报文的响应头中的content-type 如果是json就回自动转，如果不是需要人为的设置dataType:为json



### 总结

1. http协议规定了浏览器跟服务器交互的数据格式
2. 浏览器发的必须是 请求报文
3. 服务器返回的必须是 响应报文
4. 他们的组成部分分别是
   1. 请求报文
      1. 请求行
      2. 请求头
      3. 请求主体：浏览器 发给服务器的数据
   2. 响应报文
      1. 状态行
      2. 响应头:content-type 返回的数据格式，jQuery自动转JSON就是根据他来判断的
      3. 响应主体:找服务器要的数据
5. ajax的本质就是 利用XMLHttpRequest对象 设置请求行，请求头，请求主体 进而发送请求报文